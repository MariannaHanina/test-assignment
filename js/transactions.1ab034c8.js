"use strict";(self["webpackChunktest_assignment"]=self["webpackChunktest_assignment"]||[]).push([[805],{7852:function(t,s,e){e.r(s),e.d(s,{default:function(){return P}});var n=function(){var t=this,s=t._self._c;return s("div",{staticClass:"transactionss"},[s("h1",[t._v("Bitcoin Transactions")]),s("transactions-actions",{on:{start:t.start,stop:t.stop,reset:t.reset}}),t.transactions.length?s("transactions-sum",{attrs:{sum:t.sum}}):t._e(),t.transactions.length?s("transactions-table",{attrs:{transactions:t.transactions}}):t._e(),s("modal-dialog",{directives:[{name:"show",rawName:"v-show",value:!!t.alerts.length,expression:"!!alerts.length"}],on:{close:t.closeModal},scopedSlots:t._u([{key:"header",fn:function(){return[t._v(" Blockchain Connection Alerts ")]},proxy:!0}])},[s("div",t._l(t.alerts,(function({id:e,type:n,message:a}){return s("div",{key:e},[t._v(" "+t._s(n)+": "+t._s(a)+" ")])})),0)])],1)},a=[];e(7658);const r=t=>{const s=[];let e=0;for(let n of t){const{addr:t,value:a}=n.prev_out;s.push(t),e+=a}return{inputsAddresses:s,sumInputsValue:e}},o=t=>{const s=[];let e=0;for(let n of t){const{addr:t,value:a}=n;s.push(t),e+=a}return{outAddresses:s,sumOutValue:e}},i=t=>{if(!t.x)return!1;const{inputs:s,out:e}=t.x,{inputsAddresses:n,sumInputsValue:a}=r(s),{outAddresses:i,sumOutValue:c}=o(e),l=a-c;return{from:n,to:i,sum:l}};var c=e(878),l=e(8829),u=e(2575),d=new WeakMap;class h{constructor(t){(0,c.Z)(this,d,{writable:!0,value:null}),this.url=t}connect(){return(0,u.Z)(this,d,new WebSocket(this.url)),new Promise(((t,s)=>{(0,l.Z)(this,d).onopen=()=>{(0,l.Z)(this,d).readyState===WebSocket.OPEN&&t("connected"),s("rejected")}}))}send(t){const s=JSON.stringify(t);(0,l.Z)(this,d).send(s)}close(){(0,l.Z)(this,d).close()}onMessage(t){(0,l.Z)(this,d).onmessage=s=>{if(s.data){const e=JSON.parse(s.data);t(e)}}}onClose(t){(0,l.Z)(this,d).onclose=s=>{let e;e=s.wasClean?"Connection closed cleanly":"Connection failure",console.log(`Code: ${s.code} cause: ${s.reason}`),t({type:"close",message:e})}}onError(t){(0,l.Z)(this,d).onerror=s=>{t({type:"error",message:s.message})}}}var m=new WeakMap,b=new WeakMap;class v{constructor(){(0,c.Z)(this,m,{writable:!0,value:"wss://ws.blockchain.info/inv"}),(0,c.Z)(this,b,{writable:!0,value:null}),(0,u.Z)(this,b,new h((0,l.Z)(this,m)))}async connect(){return await(0,l.Z)(this,b).connect()}close(){(0,l.Z)(this,b).close()}subscribe(){(0,l.Z)(this,b).send({op:"unconfirmed_sub"})}unsubscribe(){(0,l.Z)(this,b).send({op:"unconfirmed_unsub"})}async getTransaction(t){(0,l.Z)(this,b).onMessage(t)}async getAlert(t){(0,l.Z)(this,b).onClose(t),(0,l.Z)(this,b).onError(t)}}var p=function(){var t=this,s=t._self._c;return s("div",{staticClass:"transactions-actions"},[s("button",{staticClass:"button button-start",attrs:{type:"button"},on:{click:t.start}},[t._v(" Запуск ")]),s("button",{staticClass:"button button-stop",attrs:{type:"button"},on:{click:t.stop}},[t._v(" Остановка ")]),s("button",{staticClass:"button button-reset",attrs:{type:"button"},on:{click:t.reset}},[t._v(" Сброс ")])])},_=[],f={name:"TransactionsActions",emits:["start","stop","reset"],methods:{start(){this.$emit("start")},stop(){this.$emit("stop")},reset(){this.$emit("reset")}}},Z=f,w=e(1001),C=(0,w.Z)(Z,p,_,!1,null,"b516ef4c",null),y=C.exports,g=function(){var t=this,s=t._self._c;return s("div",{staticClass:"transactions-sum"},[t._v(" Сумма: "+t._s(t._f("BTC")(t.sum))+" ")])},k=[],T={name:"TransactionsSum",props:{sum:{type:Number,default:0}}},A=T,x=(0,w.Z)(A,g,k,!1,null,null,null),S=x.exports,$=function(){var t=this,s=t._self._c;return s("table",{staticClass:"transaction-table"},[t._m(0),s("tbody",t._l(t.transactions,(function({from:e,to:n,sum:a},r){return s("tr",{key:`trns-${r}`},[s("td",{staticClass:"transaction-table-td"},t._l(e,(function(e,n){return s("div",{key:`frmadd-${n}`},[t._v(t._s(e))])})),0),s("td",{staticClass:"transaction-table-td"},t._l(n,(function(e,n){return s("div",{key:`toadd-${n}`},[t._v(t._s(e))])})),0),s("td",{staticClass:"transaction-table-td"},[t._v(t._s(t._f("BTC")(a))+" ")])])})),0)])},M=[function(){var t=this,s=t._self._c;return s("thead",[s("tr",[s("th",{staticClass:"transaction-table-th"},[t._v("From")]),s("th",{staticClass:"transaction-table-th"},[t._v("To")]),s("th",{staticClass:"transaction-table-th"},[t._v("Sum")])])])}],N={name:"TransactionsTable",props:{transactions:{type:Array,required:!0}}},O=N,V=(0,w.Z)(O,$,M,!1,null,"b92dccf2",null),W=V.exports,B=e(9924),E={name:"TransactionsView",components:{"transactions-actions":y,"transactions-sum":S,"transactions-table":W,"modal-dialog":B.Z},data(){return{transactions:[],alerts:[],sum:0}},async created(){this.service=new v,await this.service.connect(),window.addEventListener("beforeunload",this.service.close)},methods:{start(){this.service.subscribe(),this.service.getTransaction(this.addTransaction),this.service.getAlert(this.addAlert)},stop(){this.service.unsubscribe()},reset(){this.transactions=[]},addTransaction(t){const s=i(t);this.transactions=[...this.transactions,s],this.sum+=s.sum},addAlert(t){this.alerts=[...this.alerts,{...t,id:Date.now()}]},closeModal(){this.alerts=[]}}},I=E,J=(0,w.Z)(I,n,a,!1,null,"a7b456e4",null),P=J.exports}}]);
//# sourceMappingURL=transactions.1ab034c8.js.map